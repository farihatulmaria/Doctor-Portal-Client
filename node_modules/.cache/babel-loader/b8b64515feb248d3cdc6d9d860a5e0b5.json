{"ast":null,"code":"import _asyncToGenerator from\"/var/www/html/farihatulmaria/farihatulmaria/programming-hero/Module-notes/Module-71/doctor-portal/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/var/www/html/farihatulmaria/farihatulmaria/programming-hero/Module-notes/Module-71/doctor-portal/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/var/www/html/farihatulmaria/farihatulmaria/programming-hero/Module-notes/Module-71/doctor-portal/node_modules/@babel/runtime/regenerator/index.js\";import{CardElement,useElements,useStripe}from'@stripe/react-stripe-js';import React,{useEffect,useState}from'react';import{toast}from'react-toastify';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var CheckoutForm=function CheckoutForm(_ref){var appointment=_ref.appointment;var stripe=useStripe();var elements=useElements();var _useState=useState(''),_useState2=_slicedToArray(_useState,2),cardError=_useState2[0],setCardError=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),processing=_useState4[0],setProcessing=_useState4[1];var _useState5=useState(''),_useState6=_slicedToArray(_useState5,2),transactionId=_useState6[0],setTransactionId=_useState6[1];var _useState7=useState(''),_useState8=_slicedToArray(_useState7,2),clientSecret=_useState8[0],setClientSecret=_useState8[1];var _id=appointment._id,price=appointment.price,patient=appointment.patient,email=appointment.email;useEffect(function(){fetch('http://localhost:5000/create-payment-intent',{method:'POST',headers:{'content-type':'application/json','authorization':\"user \".concat(localStorage.getItem('accessToken'))},body:JSON.stringify({price:price})}).then(function(res){return res.json();}).then(function(data){if(data!==null&&data!==void 0&&data.clientSecret){setClientSecret(data.clientSecret);}});},[price]);var handleSubmit=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(e){var card,_yield$stripe$createP,error,paymentMethod,_yield$stripe$confirm,paymentIntent,intentError,payment;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:e.preventDefault();if(!(!stripe||!elements)){_context.next=3;break;}return _context.abrupt(\"return\");case 3:card=elements.getElement(CardElement);if(!(card==null)){_context.next=6;break;}return _context.abrupt(\"return\");case 6:_context.next=8;return stripe.createPaymentMethod({type:'card',card:card});case 8:_yield$stripe$createP=_context.sent;error=_yield$stripe$createP.error;paymentMethod=_yield$stripe$createP.paymentMethod;setCardError((error===null||error===void 0?void 0:error.message)||'');setProcessing(true);_context.next=15;return stripe.confirmCardPayment(clientSecret,{payment_method:{card:card,billing_details:{name:patient,email:email}}});case 15:_yield$stripe$confirm=_context.sent;paymentIntent=_yield$stripe$confirm.paymentIntent;intentError=_yield$stripe$confirm.error;if(intentError){setCardError(intentError===null||intentError===void 0?void 0:intentError.message);setProcessing(false);}else{setCardError('');setTransactionId(paymentIntent.id);toast.success(\"Congrats! Your payment is completed.\");payment={appointment:_id,transactionId:paymentIntent.id};fetch(\"http://localhost:5000/booking/\".concat(_id),{method:'PATCH',headers:{'authorization':\"user \".concat(localStorage.getItem('accessToken'))},body:JSON.stringify(payment)}).then(function(res){return res.json();}).then(function(data){setProcessing(false);console.log(data);});}case 19:case\"end\":return _context.stop();}}},_callee);}));return function handleSubmit(_x){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,children:[/*#__PURE__*/_jsx(CardElement,{options:{style:{base:{fontSize:'16px',color:'#424770','::placeholder':{color:'#aab7c4'}},invalid:{color:'#9e2146'}}}}),cardError&&/*#__PURE__*/_jsx(\"p\",{className:\"text-error mt-1\",children:cardError}),transactionId&&/*#__PURE__*/_jsxs(\"p\",{className:\"text-success mt-1\",children:[\"Your TransactionId \",transactionId]}),/*#__PURE__*/_jsx(\"button\",{className:\"my-2 btn-sm mt-4\",type:\"submit\",disabled:!stripe||!clientSecret,children:\"Pay\"})]});};export default CheckoutForm;/* disabled={!stripe || !clientSecret || success} */","map":{"version":3,"names":["CardElement","useElements","useStripe","React","useEffect","useState","toast","CheckoutForm","appointment","stripe","elements","cardError","setCardError","processing","setProcessing","transactionId","setTransactionId","clientSecret","setClientSecret","_id","price","patient","email","fetch","method","headers","localStorage","getItem","body","JSON","stringify","then","res","json","data","handleSubmit","e","preventDefault","card","getElement","createPaymentMethod","type","error","paymentMethod","message","confirmCardPayment","payment_method","billing_details","name","paymentIntent","intentError","id","success","payment","console","log","style","base","fontSize","color","invalid"],"sources":["/var/www/html/farihatulmaria/farihatulmaria/programming-hero/Module-notes/Module-71/doctor-portal/src/Pages/Dashboard/CheckoutForm.jsx"],"sourcesContent":["import { CardElement, useElements, useStripe } from '@stripe/react-stripe-js';\nimport React, { useEffect, useState } from 'react';\nimport { toast } from 'react-toastify';\n\n\nconst CheckoutForm = ({appointment}) => {\n    const stripe = useStripe();\n    const elements = useElements();\n    const [cardError, setCardError] = useState('');\n    const [processing, setProcessing] = useState(false);\n    const [transactionId, setTransactionId] = useState('');\n    const [clientSecret, setClientSecret] = useState('');\n\n\n    const {_id,price,patient,email} = appointment;\n\n    useEffect(() => {\n      fetch('http://localhost:5000/create-payment-intent', {\n            method: 'POST',\n            headers: {\n                'content-type': 'application/json',\n                'authorization': `user ${localStorage.getItem('accessToken')}`\n            },\n            body: JSON.stringify({ price })\n        })\n            .then(res => res.json())\n            .then(data => {\n                if (data?.clientSecret) {\n                    setClientSecret(data.clientSecret);\n                }\n            });\n\n    }, [price])\n\n    const handleSubmit = async (e)=>{\n        e.preventDefault();\n        if(!stripe || !elements){\n            return\n        }\n        const card = elements.getElement(CardElement);\n        if(card == null){\n            return\n        }\n        const {error,paymentMethod} = await stripe.createPaymentMethod({\n            type:'card',\n            card\n        })\n        setCardError(error?.message || '');\n        setProcessing(true);\n        const { paymentIntent, error: intentError } = await stripe.confirmCardPayment(\n            clientSecret,\n            {\n                payment_method: {\n                    card: card,\n                    billing_details: {\n                        name: patient,\n                        email: email\n                    },\n                },\n            },\n        );\n\n        if (intentError) {\n            setCardError(intentError?.message);\n            setProcessing(false);\n        }else{\n            setCardError('');\n            setTransactionId(paymentIntent.id);\n            toast.success(\"Congrats! Your payment is completed.\")\n\n            const payment = {\n                appointment:_id,\n                transactionId: paymentIntent.id\n            }\n            fetch(`http://localhost:5000/booking/${_id}`,{\n                method:'PATCH',\n                headers:{\n                    'authorization': `user ${localStorage.getItem('accessToken')}`\n                },\n                body: JSON.stringify(payment)\n            })\n            .then(res => res.json())\n            .then(data =>{\n                setProcessing(false)\n                console.log(data)\n            });\n        }\n    }\n    return (\n    <form onSubmit={handleSubmit}>\n        <CardElement\n            options={{\n                style: {\n                    base: {\n                        fontSize: '16px',\n                        color: '#424770',\n                        '::placeholder': {\n                            color: '#aab7c4',\n                        },\n                    },\n                    invalid: {\n                        color: '#9e2146',\n                    },\n                },\n            }}\n        />\n            {cardError && <p className='text-error mt-1'>{cardError}</p>}\n            {transactionId && <p className='text-success mt-1'>Your TransactionId {transactionId}</p>}\n            <button className='my-2 btn-sm mt-4' type=\"submit\" disabled={!stripe || !clientSecret}>\n                Pay\n            </button>\n    </form>\n    );\n};\n\nexport default CheckoutForm;\n/* disabled={!stripe || !clientSecret || success} */"],"mappings":"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"},"metadata":{},"sourceType":"module"}